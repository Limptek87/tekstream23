<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>TEKSTREAM â€“ LIMPTEK</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{margin:0;height:100%;background:black;color:#0f0;font-family:monospace;overflow:hidden}
#viz{position:fixed;inset:0;z-index:-1}
#ui{position:absolute;top:20px;left:50%;transform:translateX(-50%);text-align:center}
audio{width:320px;filter:invert(1) hue-rotate(90deg)}
#fs{margin-top:12px;background:black;color:#0f0;border:1px solid #0f0;padding:6px 16px;cursor:pointer;box-shadow:0 0 12px #0f0}
</style>

<script src="https://unpkg.com/butterchurn@2.6.7/dist/butterchurn.min.js"></script>
<script src="https://unpkg.com/butterchurn-presets@2.4.7/dist/butterchurnPresets.min.js"></script>
</head>
<body>

<canvas id="viz"></canvas>

<div id="ui">
<audio id="player" controls></audio>
<button id="fs">VISUALS FULLSCREEN</button>
</div>

<script>
const ITEM = "tekstream232311";
const audio = document.getElementById("player");
const canvas = document.getElementById("viz");

/* fetch all files via Archive API */
fetch(`https://archive.org/metadata/${ITEM}`)
.then(r=>r.json())
.then(data=>{
  const files = data.files
    .filter(f => f.name.endsWith(".mp3"))
    .map(f => `https://archive.org/download/${ITEM}/${f.name}`);

  let index = 0;
  audio.src = files[0];

  audio.onended = () => {
    index = (index + 1) % files.length;
    audio.src = files[index];
    audio.play();
  };
});

/* audio graph */
const ctx = new (window.AudioContext||window.webkitAudioContext)();
const src = ctx.createMediaElementSource(audio);
src.connect(ctx.destination);

/* visualizer */
const viz = butterchurn.createVisualizer(ctx, canvas,{
  width:innerWidth,
  height:innerHeight
});
viz.loadPreset(butterchurnPresets.getPresets()["Flexi - Alien Tech"],0);

function resize(){
canvas.width=innerWidth;
canvas.height=innerHeight;
viz.setRendererSize(innerWidth,innerHeight);
}
window.onresize=resize; resize();

function loop(){requestAnimationFrame(loop);viz.render()}
loop();

audio.onplay=()=>ctx.resume();

/* fullscreen */
document.getElementById("fs").onclick=()=>{
document.fullscreenElement?document.exitFullscreen():canvas.requestFullscreen()
}
</script>

</body>
</html>
